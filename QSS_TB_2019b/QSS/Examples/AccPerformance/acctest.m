% =========================================================% "Acceleration test 0-100km/h"% =========================================================%  % Before using, read the readme file!!!!!!%% #####################################################################################################################%clear all%close all%clc%warning off% #####################################################################################################################filename='qss_saab93_test2.mdl';nog=5; % Number of gears% Global variables% ----------------    % Simulation    global t    global v    global start_vel    global end_vel     global const_acc    global upshift    global downshift       % Initialization of the iteration routine% ------------------------------------------    start_vel = eps;    end_vel1=100;    max_vel1=0;    min_vel_old=0;    tol=0.1;    output=0;    % Iteration routine% --------------------    disp('Iteration started...')    disp(' ')    while start_vel<=(end_vel1/3.6)        % First gear                for k=1:1:nog            max_vel=100*end_vel1/3.6;            min_vel=start_vel;            checktol=100;            upshift=(end_vel1+1)*([1:1:nog-1]>=k);            downshift=(end_vel1+1)*([1:1:nog-1]>=k);            while (checktol)>tol,                const_acc=max_vel-start_vel;                end_vel=start_vel+const_acc;                sim(filename,[0 1]);                if length(v)==2                    max_vel=0.5*(max_vel-min_vel)+max_vel;                    checktol=abs(max_vel-min_vel);                    min_vel=max_vel;                else                    max_vel=0.5*(max_vel-min_vel)+min_vel;                    checktol=abs(max_vel-min_vel);                end            end            max_vel1=max(max_vel1,max_vel);        end%         % Second gear%         max_vel=100*end_vel1/3.6;%         min_vel=start_vel;%         checktol=100;   %         upshift=[0 end_vel1+1 end_vel1+1 end_vel1+1];%         downshift=[0 end_vel1+1 end_vel1+1 end_vel1+1];%         while (checktol)>tol,%             const_acc=max_vel-start_vel;%             end_vel=start_vel+const_acc;%             sim('qss_saab93_test2.mdl',[0 1]);%             if length(v)==2%                 max_vel=0.5*(max_vel-min_vel)+max_vel;%                 checktol=abs(max_vel-min_vel);%                 min_vel=max_vel;%             else%                 max_vel=0.5*(max_vel-min_vel)+min_vel;%                 checktol=abs(max_vel-min_vel);%             end%         end%         max_vel1=max(max_vel1,max_vel);     %         % Third gear        %         max_vel=100*end_vel1/3.6;%         min_vel=start_vel;%         checktol=100;   %         upshift=[0 0 end_vel1+1 end_vel1+1];%         downshift=[0 0 end_vel1+1 end_vel1+1];%         while (checktol)>tol,%             const_acc=max_vel-start_vel;%             end_vel=start_vel+const_acc;%             sim('qss_saab93_test2.mdl',[0 1]);%             if length(v)==2%                 max_vel=0.5*(max_vel-min_vel)+max_vel;%                 checktol=abs(max_vel-min_vel);%                 min_vel=max_vel;%             else%                 max_vel=0.5*(max_vel-min_vel)+min_vel;%                 checktol=abs(max_vel-min_vel);%             end%         end%         max_vel1=max(max_vel1,max_vel);     %         % Fourth gear        %         max_vel=100*end_vel1/3.6;%         min_vel=start_vel;%         checktol=100;   %         upshift=[0 0 0 end_vel1+1];%         downshift=[0 0 0 end_vel1+1];%         while (checktol)>tol,%             const_acc=max_vel-start_vel;%             end_vel=start_vel+const_acc;%             sim('qss_saab93_test2.mdl',[0 1]);%             if length(v)==2%                 max_vel=0.5*(max_vel-min_vel)+max_vel;%                 checktol=abs(max_vel-min_vel);%                 min_vel=max_vel;%             else%                 max_vel=0.5*(max_vel-min_vel)+min_vel;%                 checktol=abs(max_vel-min_vel);%             end%         end%         max_vel1=max(max_vel1,max_vel);     %         % Fifth gear        %         max_vel=100*end_vel1/3.6;%         min_vel=start_vel;%         checktol=100;   %         upshift=[0 0 0 0];%         downshift=[0 0 0 0];%         while (checktol)>tol,%             const_acc=max_vel-start_vel;%             end_vel=start_vel+const_acc;%             sim('qss_saab93_test2.mdl',[0 1]);%             if length(v)==2%                 max_vel=0.5*(max_vel-min_vel)+max_vel;%                 checktol=abs(max_vel-min_vel);%                 min_vel=max_vel;%             else%                 max_vel=0.5*(max_vel-min_vel)+min_vel;%                 checktol=abs(max_vel-min_vel);%             end%         end%         max_vel1=max(max_vel1,max_vel);            acctime=output+((end_vel1/3.6)-start_vel)/(max_vel1-start_vel);             output=output+1;        start_vel=max_vel1;            end        disp(' ')    disp('... iteration finished!')        disp(['Acceleration time 0-100 km/h: ', num2str(acctime,2), ' s'])% Plot results% ------------%     disp(' ')%     %disp('Hit a key to plot results:')% %     %pause%     %clc% %     % Gear ratios%     fig = figure;%     set(fig,'NumberTitle', 'off')%     set(fig,'Name', 'Optimized gear ratios')% %         plot(gear_result)%         xlabel('Iterations')%         ylabel('Gear ratios [-]')%         title('Variations of the gear ratios during the optimization')%      %     % Fuel consumption%     fig = figure;%     set(fig,'NumberTitle', 'off')%     set(fig,'Name', 'Fuel consumption')% %         plot(V_result)%         xlabel('Iterations')%         ylabel('Fuel consumption [l/100km]')%         title('Variations in fuel consumption during the optimization')%         % #####################################################################################################################